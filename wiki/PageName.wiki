#sidebar TableOfContents

= Editor Installation =

== Notes: ==

  * Let H is a host name, where we want to deploy the editor
  * Installation process is primarilly designed for a Debian-like linux, but it was tested for example on RedHat distribution after few editations as well.

Add a new user called "meditor" on H computer:
{{{sudo adduser meditor}}}

== Packages: ==

Add packages:

{{{sudo aptitude (apt-get) install mc vim aptitude acpi ssh rar sshfs wget curl openntpd ntpdate libtiff-tools imagemagick unzip htop}}}

== Database: ==

If the DB is not present, install Postgres
{{{
sudo su postgres && psql 
}}}
and run following commands:
{{{
CREATE ROLE meditor WITH PASSWORD 'samePassAsUnixPassForMeditor' LOGIN;
CREATE SCHEMA AUTHORIZATION meditor;
CREATE DATABASE meditor WITH OWNER meditor;
}}}
    * add (or ensure about their presence) the following lines to the configuration file of the postgres (_/etc/postgresql/${version}/main/pg_hba.conf_), for joining via http for user and database called "meditor"
{{{
#localhost
host	all 	meditor 	127.0.0.1/32		password
# MZK
host	all 	meditor 	195.113.155.0/24   	password
}}}
   * in file _/etc/postgresql/${version}/main/postgresql.conf_ uncomment the line "listen_addresses" and as a value set the strings "localhost" and ip address of H computer, separated by comma

   * restart postgres 
{{{
/etc/init.d/postgresql-${version} restart
}}}

== Install Tomcat: ==

{{{
wget http://websiterra.com/friends/apache/tomcat/tomcat-7/v7.0.25/bin/apache-tomcat-7.0.25.zip #(or newer)
unzip apache-tomcat-7.0.25.zip
}}}
   * Into
{{{
$CATALINA_HOME/bin/catalina.sh
}}} 
 ...add a line:
{{{
CATALINA_PID="$CATALINA_HOME/tomcat.pid"
}}} 
 place it after the command, which set a variable {{{CATALINA_HOME}}} in case it was not set yet (in version 7 Tomcat it is situated about line 100)

    * Into directory
{{{
CATALINA_HOME/lib/
}}} 
 copy the JDBC driver for Postgres (for example postgresql-${version}.jdbc4.jar)

== Environment Variable: ==

Into 
{{{
/home/meditor/.bashrc
}}} 
add the following lines (+/-):
{{{
export HISTSIZE=10000
export HISTFILESIZE=10000
export HISTCONTROL=ignoreboth
export JAVA_HOME='/home/meditor/install/jdk1.6.0_21/'
export CATALINA_HOME='/home/meditor/apache-tomcat-7.0.25/'
export CATALINA_OPTS='-server -Xmx512m -XX:MaxPermSize=128m -Xdebug -Xrunjdwp:transport=dt_socket,address=8000,server=y,suspend=n'
export PATH=$JAVA_HOME/bin:$PATH
export LC_ALL=cs_CZ.utf8
export PGCLIENTENCODING=UNICODE
}}}

== Image server: ==

   * create 
{{{
H:/home/meditor/.meditor
}}}

 * copy {{{resources/djatoka dir}}} and {{{resources/xml}}} into {{{H:/meditor/.meditor}}} (the source of copy is in SVN)
   * in war file: {{{H/user/.meditor/djatoka/dist/djatoka.war#/WEB-INF/classes/djatoka.properties}}} change password into database in {{{‘samePassAsUnixPassForMeditor}}} (mc can be used), eventually port of database too, if it is not default (5432’).

    * copy warko djatoky into Tomcat (into webapps)

Check that java is not using OpenJDK (java -version) but using JVM or oracle (HotSpot/ or JRockit). There should be equality between java, which is launched from  “$PATH” in shell and which is launched from {{{$JAVA_HOME/bin/java}}} (due to external processes as image conversion).


make a file _configuration.properties_ in H/user/.meditor and set the parameters, especially the way to import directory, way to images (internal imgserver), etc.

== DB data: ==

Add the directory META-INF into dirrectory where from will be deployted and there create a new file context.xml which includes:

{{{


   

}}}

== Reverse proxy: ==

   * Install Apache (httpd on RedHat) and check there already are (if absent, install them) moduls (/etc/apache2/mods-available) mod_proxy, mod-proxy-html a mod_ssl and mod_rewrite and activate it a2enmod (/etc/apache2/mods-enabled).
   * From any computer where is editor actually running, copy definitions of virtual guests for editor as such and for editor running in port 443 and change hostname in every places. Originalplacing is /etc/apache/sites-available on computer, where editor is running.
   * Add links for certificates into virtual guest definition for SSL.
   * Allow tese two sites by a2ensite.
   *